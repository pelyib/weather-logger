<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Weather forecast logger</title>
    <meta name="description" content="Weather forecast logger">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js" integrity="sha512-TW5s0IT/IppJtu76UbysrBH9Hy/5X41OTAbQuffZFU6lQ1rdcLHzpU5BzVvr/YFykoiMYZVWlr/PX1mDcfM9Qg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment"></script>
    <style>
div.breadcrumb-wrapper {height: 20px; overflow-y: scroll;}
div.breadcrumb-wrapper div {height: 20px; padding-left: 10px; padding-right: 10px; }
div.breadcrumb-wrapper p {height:20px; margin-top: 0px; margin-bottom: 0px; }
    </style>
    <script>
      const NAV_SCROLL_IN_PIXEL = 20
      const NAV_THROTTLING_GRACE_PERIOD = 500
      function throttle(wait) {
        var time = Date.now();
        return function() {
          if ((time + wait - Date.now()) < 0) {
            time = Date.now()
            return true
          }

          return false
        }
      }
      function scrolling(event, throttle) {
        let el = event.target
        let scrollTo = el.dataset.scrollIndex * NAV_SCROLL_IN_PIXEL
        if (throttle()) {
          el.dataset.scrollIndex++
          scrollTo = el.dataset.scrollIndex * NAV_SCROLL_IN_PIXEL
        }

        el.scroll(0, scrollTo)
      }
      function subScrolling(el) {
        let th = throttle(NAV_THROTTLING_GRACE_PERIOD)
        el.addEventListener('scroll', (event) => scrolling(event, th))
      }
      function init() {
        initNavScrolling();
      }

      function initNavScrolling() {
        document.querySelectorAll('div.breadcrumb-wrapper').forEach((el) => subScrolling(el));
      }
    </script>
  </head>
  <body onload="init();">
    <div style="width:100%; position:relative; white-space: nowrap; display: flex; flex: 1;  ">
      {{range .Breadcrumbs}}<span>/</span><div class="breadcrumb-wrapper" data-scroll-index="0" data-full-list="{{.}}" >
          {{range .}}<p><a href="{{.Link}}">{{.Title}}</a></p>{{end}}
      </div>{{end}}
    </div>
   <div width="100%" height="500px">
      <canvas id="myChart" height="500px"></canvas>
    </div>
    <script>
      const today = (new Date()).setHours(0,0,0,0);
      const ctx = document.getElementById('myChart');
      const myChart = new Chart(ctx, {
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            xAxes: {
              display: true,
              type: 'time',
              time: {
                unit: 'day',
                displayFormats: {
                  'day': 'MMM DD'
                }
              },
              ticks: {
                major: {
                  enabled: false
                }
              },
              title: {
                display: true,
                text: "Date"
              },
              grid: {
                lineWidth: function(context) {
                  if (context.tick !== undefined && context.tick.value == today) {
                    return 3;
                  }

                  return 1;
                },
                color: function(context) {
                  if (context.tick !== undefined && context.tick.value == today) {
                    return "rgba(255,0,0,0.2)";
                  }

                  return Chart.defaults.borderColor;
                }
              },
              stacked: true
            },
            yAxes: {
              title: {
                display: true,
                text: "Temperature"
              },
              grid: {
                lineWidth: function(context) {
                  if (context.tick.value == 0) {
                    return 3
                  }

                  return 1
                },
                color: function(context) {
                  if (context.tick.value == 0) {
                    return "rgba(0,0,255,0.2)";
                  }

                  return Chart.defaults.borderColor;
                }
              }
            }
          }
        },
        data: {
          labels: {{.Chart.Labels}},
          datasets: [
            {{range .Chart.Datasets}}{
              {{if eq .Label "Forecast MIN"}} 
                borderColor: "rgba(209,229,240,1)",
                backgroundColor: "rgba(209,229,240,1)",
              {{else if eq .Label "Forecast MAX"}}
                borderColor: "rgba(244,165,130,0.3)",
                backgroundColor: "rgba(244,165,130,0.6)",
              {{else if eq .Label "Historical MIN"}}
                borderColor: "rgba(33,102,172,0.9)",
                backgroundColor: "rgba(33,102,172,0.9)",
              {{else if eq .Label "Historical MAX"}}
                borderColor: "rgba(202,0,32,0.6)",
                backgroundColor: "rgba(202,0,32,0.6)",
              {{else}}
                borderColor: "rgba(118,42,131,1)",
                backgroundColor: "rgba(175,141,195,0.3)",
              {{end}}
              type: "{{.Type}}",
              label: "{{.Label}}",
              data: [
                {{range .Data}}{x:{{.X}}, y:{{.Y}}, r:{{.R}}},
                {{end}}]
            },{{end}}
          ]
        }
      });
    </script>
  </body>
</html>
